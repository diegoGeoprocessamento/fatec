1. Criar a tabela onde serão inseridos os endereços

CREATE TABLE [dbo].[tbrgeocod](
	[id] [integer] NOT NULL PRIMARY KEY,
	[rua] [nvarchar](50) NOT NULL,
	[numero] [integer],
	[bairro] [nvarchar](30) NOT NULL,
	[cidade] [nvarchar](20) NOT NULL,
	[estado] [nvarchar](20) NOT NULL,
	[cep] [integer]
);

2. Alimentar a tabela one serão inseridos os endereços

insert into tbrgeocod (id,rua,numero,bairro,cidade,estado,cep)
values
(1,'Rua Orual Salvador',543,'Jardim Santa Maria','Jacareí','São Paulo',12328470),
(2,'Rua Mariana',157,'Centro','Jacareí','São Paulo',12308180),
(3,'Avenida Nove de Julho',473,'Centro','Jacareí','São Paulo',12327682),
(4,'Rua José Benedito Duarte',59,'Vila Pinheiro','Jacareí','São Paulo',12307200),
(5,'Rua Borba Gato',48,'Jardim Paraíba','Jacareí','São Paulo',12327681);

3. Criar a tabela onde será escrito o resultado da geocodificação

CREATE TABLE [dbo].[tbwgeocod](
	[id] [integer] NOT NULL PRIMARY KEY,
	[lat] [numeric](20) NOT NULL,
	[lon] [numeric](20) NOT NULL
);

4. Criar um arquivo csharp que realize a conexão com o SQL Server e realize a consulta dos dados de interesse

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;
using System.Data.SqlClient;

namespace Geocoding
{
    class Program
    {
        static void Main(string[] args)
        {
            string strcon = "Data source=10.68.54.16,1433;initial catalog=Spatial_Test;User ID=sa;Password=123456";
            SqlConnection conexao = new SqlConnection(strcon);
            SqlCommand cmd = new SqlCommand("SELECT * FROM dbo.tbrgeocod", conexao); 

            try
            {
                int count = 0;
                List<string> list = new List<string>();
                conexao.Open();
                SqlDataReader reader = cmd.ExecuteReader();
                 while (reader.Read()) {
                    list.Add(reader[1].ToString() + "," + reader[2].ToString() + "," + reader[3].ToString() + "," + reader[4].ToString() + "," + reader[5].ToString() + "," + reader[6].ToString());
                    Console.WriteLine(list[count].ToString());
                    count += 1;
                }
                 
                Console.ReadLine();

            }
            catch (Exception ex)
            {
                Console.WriteLine("Erro " + ex.Message);
                Console.ReadLine();
                throw;
            }
            finally
            {
                conexao.Close();
            }
        }
    }
}

5. Criar um script em csharp para codificar o resultado da consulta anterior

// Default
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

// SQL Server
using System.Data;
using System.Data.SqlClient;

// Geocoding
using System.Net;
using System.Xml.Linq;

namespace Geocoding
{
    class Program
    {
        static void Main(string[] args)
        {
            string strcon = "Data source=fe80::414e:6ed4:547:5e66%9;initial catalog=Projeto;User ID=sa;Password=123";
            SqlConnection conexao = new SqlConnection(strcon);
            SqlCommand cmd = new SqlCommand("SELECT * FROM dbo.tbrgeocod", conexao);

            try
            {
                int count = 0;
                List<string> list = new List<string>();
                conexao.Open();
                SqlDataReader reader = cmd.ExecuteReader();
                while (reader.Read())
                {
                    list.Add(reader[1].ToString() + "," + reader[2].ToString() + "," + reader[3].ToString() + "," + reader[4].ToString() + "," + reader[5].ToString() + "," + reader[6].ToString());
                    //Console.WriteLine(list[count].ToString());

                    string address = list[count];
                    string requestUri = string.Format("http://maps.googleapis.com/maps/api/geocode/xml?address={0}&sensor=false", Uri.EscapeDataString(address));

                    WebRequest request = WebRequest.Create(requestUri);
                    WebResponse response = request.GetResponse();
                    XDocument xdoc = XDocument.Load(response.GetResponseStream());

                    XElement result = xdoc.Element("GeocodeResponse").Element("result");
                    XElement locationElement = result.Element("geometry").Element("location");

                    XElement lat = locationElement.Element("lat");
                    string latitude = lat.ToString();
                    XElement lng = locationElement.Element("lng");
                    string longitude = lng.ToString();

                    //Console.WriteLine(lat.ToString() + "," + lng.ToString());

                    string rlat = latitude.Replace("<lat>","").Replace("</lat>","");
                    string rlng = longitude.Replace("<lng>", "").Replace("</lng>", "");
                    Console.WriteLine(rlat + "," + rlng);

                    count += 1;

                }

                Console.ReadLine();

            }
            catch (Exception ex)
            {
                Console.WriteLine("Erro " + ex.Message);
                Console.ReadLine();
                throw;
            }
            finally
            {
                conexao.Close();
            }
        }
    }
}

6. Criar um script em csharp para inserir os dados que foram geocodificados em um tabela

